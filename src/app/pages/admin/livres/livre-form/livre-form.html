<!-- Indication du mode -->
<div class="form-mode-indicator" *ngIf="isEditMode">
  <i class="icon-edit">‚úèÔ∏è</i>
  Mode √©dition - Modification du livre
</div>

<!-- Indicateur de chargement -->
<div *ngIf="loading" class="loading-overlay">
  <div class="loading-spinner">Chargement des donn√©es...</div>
</div>
<div class="form-container">
  <!-- Header -->
  <div class="form-header">
    <button class="back-btn" routerLink="/admin/livrelist">
      <i class="icon-arrow"></i>
      Retour
    </button>
    
    <div class="header-content">
      <h1 class="page-title">Ajouter un livre</h1>
      <p class="page-subtitle">Remplissez les informations pour ajouter un livre dans la biblioth√®que</p>
    </div>
  </div>

  <!-- Formulaire -->
  <form class="form-content" [formGroup]="livreForm" (ngSubmit)="onSubmit()">
    
    <!-- Section 1: Informations de base -->
    <div class="form-section">
      <div class="section-header">
        <h3 class="section-title">
          <i class="icon-info"></i>
          Informations de base
        </h3>
      </div>

      <div class="form-grid">
        <!-- Titre du livre -->
        <div class="form-group">
          <label for="titre" class="form-label">
            Titre du livre <span class="required">*</span>
          </label>
          <input 
            type="text" 
            id="titre" 
            formControlName="titre"
            class="form-control"
            placeholder="Ex: Math√©matiques 4√®me">
          <div class="error-message" *ngIf="showError('titre')">
            {{ getError('titre') }}
          </div>
        </div>

        <!-- Auteur -->
        <div class="form-group">
          <label for="auteur" class="form-label">
            Auteur <span class="required">*</span>
          </label>
          <input 
            type="text" 
            id="auteur" 
            formControlName="auteur"
            class="form-control"
            placeholder="Ex: Dr. Hamidou DJIRE">
          <div class="error-message" *ngIf="showError('auteur')">
            {{ getError('auteur') }}
          </div>
        </div>

        <!-- ISBN -->
        <div class="form-group">
          <label for="isbn" class="form-label">ISBN</label>
          <input 
            type="text" 
            id="isbn" 
            formControlName="isbn"
            class="form-control"
            placeholder="Ex: 978-2-1234-5680-3">
        </div>

        <!-- √âditeur -->
        <div class="form-group">
          <label for="editeur" class="form-label">√âditeur</label>
          <input 
            type="text" 
            id="editeur" 
            formControlName="editeur"
            class="form-control"
            placeholder="Ex: Edition EDUGO">
        </div>

        <!-- Description -->
        <div class="form-group full-width">
          <label for="description" class="form-label">Description</label>
          <textarea 
            id="description" 
            formControlName="description"
            rows="3" 
            class="form-control"
            placeholder="Description d√©taill√©e du livre..."></textarea>
          <div class="char-counter">
            {{ description?.value?.length || 0 }}/500
          </div>
        </div>
      </div>
    </div>

    <!-- Section 2: Classification -->
    <div class="form-section">
      <div class="section-header">
        <h3 class="section-title">
          <i class="icon-category"></i>
          Classification
        </h3>
      </div>

      <div class="form-grid">
        <!-- Mati√®re -->
        <div class="form-group">
          <label for="matiere" class="form-label">
            Mati√®re <span class="required">*</span>
          </label>
          <div class="input-wrapper">
            <select id="matiere" formControlName="matiere" class="form-control">
              <option value="">S√©lectionner une mati√®re</option>
              <option *ngFor="let matiere of matieres" [value]="matiere.id">{{ matiere.nom }}</option>
            </select>
            <i class="dropdown-arrow">‚ñº</i>
          </div>
          <div class="error-message" *ngIf="showError('matiere')">
            {{ getError('matiere') }}
          </div>
        </div>

        <!-- Niveau scolaire -->
        <div class="form-group">
          <label for="niveau" class="form-label">
            Niveau scolaire <span class="required">*</span>
          </label>
          <div class="input-wrapper">
            <select id="niveau" formControlName="niveau" class="form-control">
              <option value="">S√©lectionner un niveau</option>
              <option *ngFor="let niveau of niveaux" [value]="niveau.id">{{ niveau.nom }}</option>
            </select>
            <i class="dropdown-arrow">‚ñº</i>
          </div>
          <div class="error-message" *ngIf="showError('niveau')">
            {{ getError('niveau') }}
          </div>
        </div>

        <!-- Classe -->
        <div class="form-group">
          <label for="classe" class="form-label">
            Classe <span class="required">*</span>
          </label>
          <div class="input-wrapper">
            <select id="classe" formControlName="classe" class="form-control">
              <option value="">S√©lectionner une classe</option>
              <option *ngFor="let c of classes" [value]="c.id">{{ c.nom }}</option>
            </select>
            <i class="dropdown-arrow">‚ñº</i>
          </div>
          <div class="error-message" *ngIf="showError('classe')">
            {{ getError('classe') }}
          </div>
        </div>

       <!-- Section Langue -->
<div class="form-group">
  <label for="langue" class="form-label">Langue <span class="required">*</span></label>
  <div class="input-wrapper">
    <select id="langue" formControlName="langue" class="form-control">
      <option value="">S√©lectionner une langue</option>
      <option *ngFor="let langue of langues" [value]="langue.id">{{ langue.nom }} ({{ langue.codeIso }})</option>
    </select>
    <i class="dropdown-arrow">‚ñº</i>
  </div>
  <div class="error-message" *ngIf="showError('langue')">
    {{ getError('langue') }}
  </div>
</div>
      </div>
    </div>

    <!-- Section 3: Fichiers du livre -->
    <div class="form-section">
      <div class="section-header">
        <h3 class="section-title">
          <i class="icon-file"></i>
          Fichiers du livre
        </h3>
      </div>

      <div class="form-grid">
        <!-- Fichier principal -->
        <div class="form-group full-width">
          <label class="form-label">
            Fichier principal (PDF/EPUB) <span class="required">*</span>
          </label>
          <div class="file-upload-area" 
               (click)="fileInput.click()"
               (dragover)="onDragOver($event)"
               (drop)="onDrop($event, 'file')"
               [class.has-file]="livreForm.get('fichierPrincipal')?.value">
            <input 
              type="file" 
              #fileInput 
              class="file-input" 
              accept=".pdf,.epub"
              (change)="onFileSelected($event, 'file')">
            <div class="upload-content">
              <i class="upload-icon">üì•</i>
              <div class="upload-text">
                <div class="upload-main">
                  {{ livreForm.get('fichierPrincipal')?.value ? livreForm.get('fichierPrincipal')?.value.name : 'Glissez-d√©posez votre fichier ici ou cliquez pour parcourir' }}
                </div>
                <div class="upload-sub">Formats accept√©s: PDF, EPUB ‚Ä¢ Taille max: 50 MB</div>
              </div>
            </div>
          </div>
          <div class="error-message" *ngIf="showError('fichierPrincipal')">
            {{ getError('fichierPrincipal') }}
          </div>
        </div>
      </div>
    </div>

    <!-- Section 4: Image de couverture -->
    <div class="form-section">
      <div class="section-header">
        <h3 class="section-title">
          <i class="icon-image"></i>
          Image de couverture
        </h3>
      </div>

      <div class="form-grid">
        <div class="form-group full-width">
          <label class="form-label">Image de couverture</label>
          <div class="image-upload-area"
               (click)="imageInput.click()"
               (dragover)="onDragOver($event)"
               (drop)="onDrop($event, 'image')"
               [class.has-file]="livreForm.get('imageCouverture')?.value">
            <input 
              type="file" 
              #imageInput 
              class="file-input" 
              accept=".jpg,.jpeg,.png,.webp"
              (change)="onFileSelected($event, 'image')">
            <div class="upload-content">
              <i class="upload-icon">üñºÔ∏è</i>
              <div class="upload-text">
                <div class="upload-main">
                  {{ livreForm.get('imageCouverture')?.value ? livreForm.get('imageCouverture')?.value.name : 'Glissez-d√©posez l\'image de couverture' }}
                </div>
                <div class="upload-sub">Formats: JPG, PNG, WebP ‚Ä¢ Taille max: 10 MB</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Section 5: Options avanc√©es -->
    <div class="form-section">
      <div class="section-header">
        <h3 class="section-title">
          <i class="icon-settings"></i>
          Options avanc√©es
        </h3>
      </div>

      <div class="form-grid">
        <!-- Checkboxes -->
        <div class="form-group full-width">
          <div class="checkboxes-group">
            <label class="checkbox-item">
              <input 
                type="checkbox" 
                formControlName="lectureAuto"
                class="checkbox-input">
              <span class="checkbox-custom"></span>
              <span class="checkbox-label">Activer la lecture automatique</span>
            </label>
            <label class="checkbox-item">
              <input 
                type="checkbox" 
                formControlName="interactif"
                class="checkbox-input">
              <span class="checkbox-custom"></span>
              <span class="checkbox-label">Livre interactif avec exercices int√©gr√©s</span>
            </label>
            <label class="checkbox-item">
              <input 
                type="checkbox" 
                formControlName="telechargementHorsLigne"
                class="checkbox-input">
              <span class="checkbox-custom"></span>
              <span class="checkbox-label">Autoriser le t√©l√©chargement hors ligne</span>
            </label>
          </div>
        </div>

        <!-- Mots-cl√©s et Ann√©e -->
        <div class="form-group">
          <label for="motsCles" class="form-label">Mots-cl√©s</label>
          <input 
            type="text" 
            id="motsCles" 
            formControlName="motsCles"
            class="form-control"
            placeholder="Fran√ßais, Math√©matiques...">
        </div>

        <div class="form-group">
          <label for="anneePublication" class="form-label">Ann√©e de publication</label>
          <div class="input-wrapper">
            <input id="anneePublication"
                   class="form-control"
                   formControlName="anneePublication"
                   list="anneesList"
                   placeholder="Ex: 2024" />
            <datalist id="anneesList">
              <option *ngFor="let a of annees" [value]="a">{{ a }}</option>
            </datalist>
          </div>
          <div class="error-message" *ngIf="showError('anneePublication')">
            {{ getError('anneePublication') }}
          </div>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="onAnnuler()">
        <i class="icon-cancel"></i>
        Annuler
      </button>
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="isReadOnly || !livreForm.valid || isSubmitting">
        <i class="icon-save" [class.loading]="isSubmitting"></i>
        {{ isReadOnly ? 'Lecture seule' : (isSubmitting ? 'Enregistrement...' : 'Enregistrer le livre') }}
      </button>
    </div>
  </form>
</div>