<div class="content-page">
  <div class="header">
    <h1>Gestion des Contenus</h1>
    <p class="subtitle">Gérez les matières, niveaux et classes</p>
  </div>

  <!-- Loading indicator -->
  <div *ngIf="loading" class="loading-indicator">
    <p>Chargement des données...</p>
  </div>
  
  <!-- Error message -->
  <div *ngIf="error" class="error-message">
    <p>{{ error }}</p>
    <button class="retry-btn" (click)="loadData()">Réessayer</button>
  </div>

  <div class="tabs" *ngIf="!loading && !error">
    <button 
      class="tab-btn" 
      [class.active]="currentTab === 'subjects'"
      (click)="switchTab('subjects')">
      Matières
    </button>
    <button 
      class="tab-btn" 
      [class.active]="currentTab === 'levels'"
      (click)="switchTab('levels')">
      Niveaux
    </button>
    <button 
      class="tab-btn" 
      [class.active]="currentTab === 'classes'"
      (click)="switchTab('classes')">
      Classes
    </button>
  </div>

  <div class="content-section" *ngIf="!loading && !error">
    <!-- Subjects Tab -->
    <div *ngIf="currentTab === 'subjects'" class="tab-content">
      <div class="header-actions">
        <h2>Matières</h2>
        <button class="add-btn" (click)="openAddModal()">
          <i class="fas fa-plus"></i>
          Ajouter une matière
        </button>
      </div>
      
      <div class="stats-cards">
        <div class="stat-card">
          <div class="stat-value">{{ subjects.length }}</div>
          <div class="stat-label">Matières</div>
        </div>
      </div>

      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>Nom</th>
              <th>Description</th>
              <th>Quiz</th>
              <th>Étudiants</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let subject of subjects">
              <td>{{ subject.name }}</td>
              <td>{{ subject.description }}</td>
              <td>{{ subject.quizCount }}</td>
              <td>{{ subject.studentsCount }}</td>
              <td class="actions">
                <button class="action-btn edit" (click)="openEditModal(subject.id)">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="action-btn delete" (click)="deleteItem(subject.id)">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Levels Tab -->
    <div *ngIf="currentTab === 'levels'" class="tab-content">
      <div class="header-actions">
        <h2>Niveaux</h2>
        <button class="add-btn" (click)="openAddModal()">
          <i class="fas fa-plus"></i>
          Ajouter un niveau
        </button>
      </div>
      
      <div class="stats-cards">
        <div class="stat-card">
          <div class="stat-value">{{ levels.length }}</div>
          <div class="stat-label">Niveaux</div>
        </div>
      </div>

      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>Nom</th>
              <th>Cycle</th>
              <th>Classes</th>
              <th>Étudiants</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let level of levels">
              <td>{{ level.name }}</td>
              <td>
                <span class="badge" [class.badge-primary]="level.cycle === 'college'" 
                      [class.badge-secondary]="level.cycle === 'lycee'">
                  {{ level.cycle === 'college' ? 'Collège' : 'Lycée' }}
                </span>
              </td>
              <td>{{ level.classesCount }}</td>
              <td>{{ level.studentsCount }}</td>
              <td class="actions">
                <button class="action-btn edit" (click)="openEditModal(level.id)">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="action-btn delete" (click)="deleteItem(level.id)">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Classes Tab -->
    <div *ngIf="currentTab === 'classes'" class="tab-content">
      <div class="header-actions">
        <h2>Classes</h2>
        <button class="add-btn" (click)="openAddModal()">
          <i class="fas fa-plus"></i>
          Ajouter une classe
        </button>
      </div>
      
      <div class="stats-cards">
        <div class="stat-card">
          <div class="stat-value">{{ classes.length }}</div>
          <div class="stat-label">Classes</div>
        </div>
      </div>

      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>Nom</th>
              <th>Niveau</th>
              <th>Professeur</th>
              <th>Étudiants</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let class of classes">
              <td>{{ class.name }}</td>
              <td>{{ class.level }}</td>
              <td>{{ class.teacher }}</td>
              <td>{{ class.studentsCount }}</td>
              <td class="actions">
                <button class="action-btn edit" (click)="openEditModal(class.id)">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="action-btn delete" (click)="deleteItem(class.id)">
                  <i class="fas fa-trash"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal" *ngIf="isModalOpen">
    <div class="modal-content">
      <div class="modal-header">
        <h3>{{ modalTitle }}</h3>
        <button class="close-btn" (click)="closeModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form (ngSubmit)="saveContent()" #contentForm="ngForm">
          <div class="form-group">
            <label for="name">Nom *</label>
            <input 
              type="text" 
              id="name" 
              [(ngModel)]="formData.name" 
              name="name" 
              class="form-control"
              required>
          </div>

          <div class="form-group" *ngIf="showSubjectFields">
            <label for="description">Description</label>
            <textarea 
              id="description" 
              [(ngModel)]="formData.description" 
              name="description" 
              class="form-control"
              rows="3"></textarea>
          </div>

          <div class="form-group" *ngIf="showLevelFields">
            <label for="cycle">Cycle</label>
            <select 
              id="cycle" 
              [(ngModel)]="formData.cycle" 
              name="cycle" 
              class="form-control">
              <option value="college">Collège</option>
              <option value="lycee">Lycée</option>
            </select>
          </div>

          <div class="form-group" *ngIf="showClassFields">
            <label for="level">Niveau</label>
            <select 
              id="level" 
              [(ngModel)]="formData.level" 
              name="level" 
              class="form-control">
              <option *ngFor="let level of levels" [value]="level.name">{{ level.name }}</option>
            </select>
          </div>

          <div class="form-group" *ngIf="showClassFields">
            <label for="teacher">Professeur</label>
            <input 
              type="text" 
              id="teacher" 
              [(ngModel)]="formData.teacher" 
              name="teacher" 
              class="form-control">
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeModal()">Annuler</button>
            <button type="submit" class="btn btn-primary" [disabled]="!formData.name.trim()">Enregistrer</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>